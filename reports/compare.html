<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Compare latest 2 reports</title>
  <style>
    body { font-family: Arial; }
    table { border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px 12px; }
    th { background: #f4f4f4; }
  </style>
</head>
<body>
<h2>Compare latest 2 reports</h2>

<table id="compare-table">
  <thead>
    <tr>
      <th>Metric</th>
      <th>Previous</th>
      <th>Latest</th>
      <th>Î” (%)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
fetch("./summary.json")
  .then(res => res.json())
  .then(data => {
    if (data.length < 2) {
      document.body.insertAdjacentHTML(
        "beforeend",
        "<p><b>Not enough data to compare</b></p>"
      );
      return;
    }

    const prev = data[data.length - 2];
    const latest = data[data.length - 1];

    const rows = [
      ["Avg (ms)", prev.avg, latest.avg],
      ["P90 (ms)", prev.p90, latest.p90],
      ["P95 (ms)", prev.p95, latest.p95],
      ["Error (%)", prev.errorRate, latest.errorRate],
    ];

    const tbody = document.querySelector("#compare-table tbody");

    rows.forEach(([label, v1, v2]) => {
      const delta = v1 === 0 ? 0 : (((v2 - v1) / v1) * 100).toFixed(2);
      tbody.insertAdjacentHTML("beforeend", `
        <tr>
          <td>${label}</td>
          <td>${v1}</td>
          <td>${v2}</td>
          <td>${delta}%</td>
        </tr>
      `);
    });
  })
  .catch(err => {
    document.body.insertAdjacentHTML(
      "beforeend",
      "<p><b>Failed to load summary.json</b></p>"
    );
    console.error(err);
  });
</script>
</body>
</html>
